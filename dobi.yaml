# https://dnephin.github.io/dobi/index.html
---
meta:
  project: eerorika/build-cpp
  default: all

image=runtime:
  image: '{project}'
  tags: [runtime]
  context: runtime
  args:
    BASE: 'debian:unstable-slim'
    V_CLANG_ARG: '11'
    V_GCC_ARG: '10'
    V_LIBSTD_ARG: '6'
    V_LIBCXX_ARG: '1'

image=runtime-ci:
  image: '{project}'
  tags: [runtime-ci]
  context: runtime-ci
  args:
    BASE: '{project}:runtime'
  depends: [runtime]

image=compile-base:
  image: '{project}'
  tags: [compile-base]
  context: compile-base
  args:
    BASE: '{project}:runtime-ci'
  depends: [runtime-ci]

image=clang-tools:
  image: '{project}'
  tags: [clang-tools]
  context: clang-tools
  args:
    BASE: '{project}:compile-base'
  depends: [compile-base]

image=compile-clang-base:
  image: '{project}'
  tags: [compile-clang-base]
  context: compile-clang-base
  args:
    BASE: '{project}:clang-tools'
  depends: [clang-tools]

image=compile-clang-lcxx:
  image: '{project}'
  tags: [compile-clang-lcxx]
  context: compile-clang-lcxx
  args:
    BASE: '{project}:compile-clang-base'
  depends: [compile-clang-base]

image=compile-clang-lstdcxx:
  image: '{project}'
  tags: [compile-clang-lstdcxx]
  context: compile-clang-lstdcxx
  args:
    BASE: '{project}:compile-clang-base'
  depends: [compile-clang-base]

image=compile-gnu:
  image: '{project}'
  tags: [compile-gnu]
  context: compile-gnu
  args:
    BASE: '{project}:compile-base'
  depends: [compile-base]

alias=all:
  tasks:
    - runtime
    - runtime-ci
    - clang-tools
    - compile-clang-lcxx
    - compile-clang-lstdcxx
    - compile-gnu
